<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:beatthebank="clr-namespace:BeatTheBank"
             xmlns:models="clr-namespace:BeatTheBank.Models"
             xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
             x:DataType="beatthebank:LeaderboardViewModel"
             x:Class="BeatTheBank.LeaderboardPage"
             Title="Leaderboard">

    <RefreshView IsRefreshing="{Binding IsRefreshing}"
                 Command="{Binding RefreshCommand}">
        <ScrollView>
            <VerticalStackLayout Spacing="16" Padding="20,10">

                <!-- ===== TITLE BANNER ===== -->
                <Border BackgroundColor="{AppThemeBinding Light={StaticResource Tertiary}, Dark={StaticResource Gray950}}"
                        Padding="20,14"
                        Stroke="Transparent"
                        StrokeShape="RoundRectangle 16">
                    <Border.Shadow>
                        <Shadow Brush="{AppThemeBinding Light={StaticResource Gray600}, Dark={StaticResource Black}}"
                                Offset="3,5"
                                Radius="12"
                                Opacity="0.4" />
                    </Border.Shadow>
                    <VerticalStackLayout Spacing="2" HorizontalOptions="Center">
                        <Label Text="TOP PLAYERS"
                               FontSize="28"
                               FontAttributes="Bold"
                               FontFamily="OpenSansSemibold"
                               TextColor="{StaticResource JackpotGlow}"
                               HorizontalOptions="Center" />
                        <Label Text="Pull down to refresh standings"
                               FontSize="13"
                               TextColor="{StaticResource Gray300}"
                               HorizontalOptions="Center" />
                    </VerticalStackLayout>
                </Border>

                <!-- ===== NEW GAME BUTTON ===== -->
                <Button Text="New Game"
                        Command="{Binding NewGameCommand}"
                        BackgroundColor="{AppThemeBinding Light={StaticResource Primary}, Dark={StaticResource PrimaryDark}}"
                        TextColor="{StaticResource White}"
                        FontAttributes="Bold"
                        FontSize="18"
                        HeightRequest="50" />

                <!-- ===== PLAYER LIST ===== -->
                <CollectionView ItemsSource="{Binding Players}"
                                SelectionMode="None">

                    <!-- Empty State -->
                    <CollectionView.EmptyView>
                        <Border BackgroundColor="{AppThemeBinding Light={StaticResource CardLight}, Dark={StaticResource CardDark}}"
                                Padding="30,40"
                                Stroke="{AppThemeBinding Light={StaticResource Secondary}, Dark={StaticResource SecondaryDark}}"
                                StrokeThickness="2"
                                StrokeShape="RoundRectangle 16">
                            <Border.Shadow>
                                <Shadow Brush="{AppThemeBinding Light={StaticResource Gray600}, Dark={StaticResource Black}}"
                                        Offset="3,6"
                                        Radius="14"
                                        Opacity="0.4" />
                            </Border.Shadow>
                            <VerticalStackLayout Spacing="12" HorizontalOptions="Center">
                                <Label Text="ðŸ¦"
                                       FontSize="48"
                                       HorizontalOptions="Center" />
                                <Label Text="THE VAULT IS EMPTY"
                                       FontSize="20"
                                       FontAttributes="Bold"
                                       FontFamily="OpenSansSemibold"
                                       TextColor="{AppThemeBinding Light={StaticResource Primary}, Dark={StaticResource PrimaryLight}}"
                                       HorizontalOptions="Center" />
                                <Label Text="No one has cracked the bank yet.&#10;Go play some rounds and claim your spot!"
                                       FontSize="14"
                                       TextColor="{StaticResource Gray400}"
                                       HorizontalOptions="Center"
                                       HorizontalTextAlignment="Center"
                                       LineHeight="1.4" />
                            </VerticalStackLayout>
                        </Border>
                    </CollectionView.EmptyView>

                    <CollectionView.ItemTemplate>
                        <DataTemplate x:DataType="models:PlayerStats">
                            <Border Margin="0,4"
                                    Padding="0"
                                    Stroke="{AppThemeBinding Light={StaticResource Secondary}, Dark={StaticResource SecondaryDark}}"
                                    StrokeThickness="2"
                                    BackgroundColor="{AppThemeBinding Light={StaticResource CardLight}, Dark={StaticResource CardDark}}"
                                    StrokeShape="RoundRectangle 14">
                                <Border.Shadow>
                                    <Shadow Brush="{AppThemeBinding Light={StaticResource Gray600}, Dark={StaticResource Black}}"
                                            Offset="3,5"
                                            Radius="12"
                                            Opacity="0.35" />
                                </Border.Shadow>
                                <VerticalStackLayout Spacing="0">

                                    <!-- Player Header: Name + Total Won -->
                                    <Border BackgroundColor="{AppThemeBinding Light={StaticResource Tertiary}, Dark={StaticResource Gray950}}"
                                            Padding="16,12"
                                            Stroke="Transparent"
                                            StrokeShape="RoundRectangle 14,14,0,0">
                                        <Grid ColumnDefinitions="*,Auto" ColumnSpacing="10">
                                            <Label Grid.Column="0"
                                                   Text="{Binding PlayerName}"
                                                   FontSize="20"
                                                   FontAttributes="Bold"
                                                   FontFamily="OpenSansSemibold"
                                                   TextColor="{StaticResource JackpotGlow}"
                                                   VerticalOptions="Center" />
                                            <Border Grid.Column="1"
                                                    BackgroundColor="{AppThemeBinding Light={StaticResource Secondary}, Dark={StaticResource SecondaryDark}}"
                                                    Padding="12,6"
                                                    Stroke="Transparent"
                                                    StrokeShape="RoundRectangle 10">
                                                <Label Text="{Binding TotalWon, StringFormat='${0:N0}'}"
                                                       FontSize="18"
                                                       FontAttributes="Bold"
                                                       FontFamily="OpenSansSemibold"
                                                       TextColor="{StaticResource White}" />
                                            </Border>
                                        </Grid>
                                    </Border>

                                    <!-- Core Stats -->
                                    <Grid Padding="16,14"
                                          ColumnDefinitions="*,*,*"
                                          RowDefinitions="Auto,Auto"
                                          ColumnSpacing="8"
                                          RowSpacing="12">

                                        <!-- Row 1 -->
                                        <VerticalStackLayout Grid.Column="0" Grid.Row="0" Spacing="2" HorizontalOptions="Center">
                                            <Label Text="GAMES"
                                                   FontSize="10"
                                                   FontAttributes="Bold"
                                                   TextColor="{StaticResource Gray400}"
                                                   HorizontalOptions="Center" />
                                            <Label Text="{Binding GamesPlayed}"
                                                   FontSize="18"
                                                   FontAttributes="Bold"
                                                   HorizontalOptions="Center" />
                                        </VerticalStackLayout>

                                        <VerticalStackLayout Grid.Column="1" Grid.Row="0" Spacing="2" HorizontalOptions="Center">
                                            <Label Text="WIN RATE"
                                                   FontSize="10"
                                                   FontAttributes="Bold"
                                                   TextColor="{StaticResource Gray400}"
                                                   HorizontalOptions="Center" />
                                            <Label Text="{Binding WinRate, StringFormat='{0:F1}%'}"
                                                   FontSize="18"
                                                   FontAttributes="Bold"
                                                   TextColor="{AppThemeBinding Light={StaticResource Secondary}, Dark={StaticResource SecondaryLight}}"
                                                   HorizontalOptions="Center" />
                                        </VerticalStackLayout>

                                        <VerticalStackLayout Grid.Column="2" Grid.Row="0" Spacing="2" HorizontalOptions="Center">
                                            <Label Text="JACKPOTS"
                                                   FontSize="10"
                                                   FontAttributes="Bold"
                                                   TextColor="{StaticResource Gray400}"
                                                   HorizontalOptions="Center" />
                                            <Label Text="{Binding JackpotsHit}"
                                                   FontSize="18"
                                                   FontAttributes="Bold"
                                                   TextColor="{AppThemeBinding Light={StaticResource Primary}, Dark={StaticResource PrimaryLight}}"
                                                   HorizontalOptions="Center" />
                                        </VerticalStackLayout>

                                        <!-- Row 2 -->
                                        <VerticalStackLayout Grid.Column="0" Grid.Row="1" Spacing="2" HorizontalOptions="Center">
                                            <Label Text="BUSTED"
                                                   FontSize="10"
                                                   FontAttributes="Bold"
                                                   TextColor="{StaticResource Gray400}"
                                                   HorizontalOptions="Center" />
                                            <Label Text="{Binding TimesBusted}"
                                                   FontSize="18"
                                                   FontAttributes="Bold"
                                                   TextColor="{StaticResource Danger}"
                                                   HorizontalOptions="Center" />
                                        </VerticalStackLayout>

                                        <VerticalStackLayout Grid.Column="1" Grid.Row="1" Spacing="2" HorizontalOptions="Center">
                                            <Label Text="STOPPED"
                                                   FontSize="10"
                                                   FontAttributes="Bold"
                                                   TextColor="{StaticResource Gray400}"
                                                   HorizontalOptions="Center" />
                                            <Label Text="{Binding TimesStopped}"
                                                   FontSize="18"
                                                   FontAttributes="Bold"
                                                   HorizontalOptions="Center" />
                                        </VerticalStackLayout>

                                        <VerticalStackLayout Grid.Column="2" Grid.Row="1" Spacing="2" HorizontalOptions="Center">
                                            <Label Text="BEST GAME"
                                                   FontSize="10"
                                                   FontAttributes="Bold"
                                                   TextColor="{StaticResource Gray400}"
                                                   HorizontalOptions="Center" />
                                            <Label Text="{Binding BestSingleGame, StringFormat='${0:N0}'}"
                                                   FontSize="18"
                                                   FontAttributes="Bold"
                                                   TextColor="{AppThemeBinding Light={StaticResource Secondary}, Dark={StaticResource SecondaryLight}}"
                                                   HorizontalOptions="Center" />
                                        </VerticalStackLayout>
                                    </Grid>

                                    <!-- Divider -->
                                    <BoxView HeightRequest="1"
                                             Color="{AppThemeBinding Light={StaticResource Gray200}, Dark={StaticResource Gray600}}"
                                             Margin="16,0" />

                                    <!-- Advanced Stats (Expandable) -->
                                    <toolkit:Expander>
                                        <toolkit:Expander.Header>
                                            <Border BackgroundColor="Transparent"
                                                    Padding="16,10"
                                                    Stroke="Transparent">
                                                <Label Text="MORE STATS â–¾"
                                                       FontSize="11"
                                                       FontAttributes="Bold"
                                                       TextColor="{AppThemeBinding Light={StaticResource Gray500}, Dark={StaticResource Gray400}}"
                                                       HorizontalOptions="Center" />
                                            </Border>
                                        </toolkit:Expander.Header>

                                        <Grid Padding="16,4,16,14"
                                              ColumnDefinitions="*,*"
                                              RowDefinitions="Auto,Auto,Auto"
                                              ColumnSpacing="8"
                                              RowSpacing="10">

                                            <VerticalStackLayout Grid.Column="0" Grid.Row="0" Spacing="1" HorizontalOptions="Center">
                                                <Label Text="AVG VAULTS"
                                                       FontSize="10"
                                                       FontAttributes="Bold"
                                                       TextColor="{StaticResource Gray400}"
                                                       HorizontalOptions="Center" />
                                                <Label Text="{Binding AvgVaultsPerGame, StringFormat='{0:F1}'}"
                                                       FontSize="16"
                                                       FontAttributes="Bold"
                                                       HorizontalOptions="Center" />
                                            </VerticalStackLayout>

                                            <VerticalStackLayout Grid.Column="1" Grid.Row="0" Spacing="1" HorizontalOptions="Center">
                                                <Label Text="STREAK"
                                                       FontSize="10"
                                                       FontAttributes="Bold"
                                                       TextColor="{StaticResource Gray400}"
                                                       HorizontalOptions="Center" />
                                                <Label Text="{Binding LongestStreak}"
                                                       FontSize="16"
                                                       FontAttributes="Bold"
                                                       TextColor="{AppThemeBinding Light={StaticResource Primary}, Dark={StaticResource PrimaryLight}}"
                                                       HorizontalOptions="Center" />
                                            </VerticalStackLayout>

                                            <VerticalStackLayout Grid.Column="0" Grid.Row="1" Spacing="1" HorizontalOptions="Center">
                                                <Label Text="LEFT ON TABLE"
                                                       FontSize="10"
                                                       FontAttributes="Bold"
                                                       TextColor="{StaticResource Gray400}"
                                                       HorizontalOptions="Center" />
                                                <Label Text="{Binding MoneyLeftOnTable, StringFormat='${0:N0}'}"
                                                       FontSize="16"
                                                       FontAttributes="Bold"
                                                       TextColor="{StaticResource Danger}"
                                                       HorizontalOptions="Center" />
                                            </VerticalStackLayout>

                                            <VerticalStackLayout Grid.Column="1" Grid.Row="1" Spacing="1" HorizontalOptions="Center">
                                                <Label Text="POTENTIAL"
                                                       FontSize="10"
                                                       FontAttributes="Bold"
                                                       TextColor="{StaticResource Gray400}"
                                                       HorizontalOptions="Center" />
                                                <Label Text="{Binding PotentialWinnings, StringFormat='${0:N0}'}"
                                                       FontSize="16"
                                                       FontAttributes="Bold"
                                                       HorizontalOptions="Center" />
                                            </VerticalStackLayout>

                                            <VerticalStackLayout Grid.Column="0" Grid.Row="2" Grid.ColumnSpan="2" Spacing="1" HorizontalOptions="Center">
                                                <Label Text="RISK SCORE"
                                                       FontSize="10"
                                                       FontAttributes="Bold"
                                                       TextColor="{StaticResource Gray400}"
                                                       HorizontalOptions="Center" />
                                                <!-- Risk bar -->
                                                <Grid WidthRequest="180" HeightRequest="20" HorizontalOptions="Center">
                                                    <Border BackgroundColor="{AppThemeBinding Light={StaticResource SurfaceLight}, Dark={StaticResource SurfaceDark}}"
                                                            Padding="0"
                                                            Stroke="Transparent"
                                                            StrokeShape="RoundRectangle 6"
                                                            HorizontalOptions="Fill" />
                                                    <Label Text="{Binding RiskScore, StringFormat='{0:F0}% Risk'}"
                                                           FontSize="11"
                                                           FontAttributes="Bold"
                                                           TextColor="{AppThemeBinding Light={StaticResource Gray600}, Dark={StaticResource Gray300}}"
                                                           HorizontalOptions="Center"
                                                           VerticalOptions="Center" />
                                                </Grid>
                                            </VerticalStackLayout>
                                        </Grid>
                                    </toolkit:Expander>

                                </VerticalStackLayout>
                            </Border>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>

            </VerticalStackLayout>
        </ScrollView>
    </RefreshView>
</ContentPage>
